<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/homepage.css">
        <link rel="shortcut icon" href="/logo-small.svg" type="image/x-icon">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <title>Homepage | Fluke</title>
    </head>
    <body>
        <h1>Welcome <%= name %></h1>
        <div class="display-frame">
            <div class="slider is-set" id="slider"></div>
        </div>
        <main>
            <div id="media" class="media"></div>
            <div class="media-sec" id="pg-movies">
                <script>
                    const sublevels = ["Free","With Subscription","With Pro-Subscription"];
                    var slider = document.getElementById("slider");
                    let allInfo = `<%- allInfo.replace(/'/g, "\\'") %>`;
                    var mov = JSON.parse(allInfo);
                    let ht = '';
                    for (const media of mov) {
                        ht += `<div class="media-tile">
                                    <img src=${media["poster"]} alt="movie poster">
                                    <div class="media-info">
                                        <span class="title">${media["title"]}</span>
                                        <div>
                                            <a href=/player?fid=${media["full_id"]}>Play</a>
                                            <button></butt
                                        </div>
                                        <div class="desc">
                                            <span>${media["year"]}</span>&nbsp;●&nbsp;
                                            <span>${media["rating"]}</span>
                                        </div>
                                    </div>
                                </div>`;
                    }
                    document.getElementById("media").innerHTML = ht;
                    ht = '';
                    let displen = 4;
                    let dispstart = Math.floor(Math.random() * (mov.length - displen));
                    let dispmov = mov.slice(dispstart,dispstart+displen);
                    for (const media of dispmov) {
                        ht += `<div class="slide" style="background-image: url(${media["poster"]});">
                                    <div class="slide-info">
                                        <span class="title">${media["title"]}</span>
                                        <div class="subin">
                                            <span>${media["year"]}</span>●
                                            <span>Rating : ${media["rating"]}</span>●
                                            <span>${sublevels[media["sublevel"]]}</span>
                                        </div>
                                        <span class="description">${media["plot"].substring(0,200)}...</span>
                                    </div>
                                </div>`;
                    }
                    slider.innerHTML = ht;
                    let slides = document.getElementsByClassName("slide");
                    slides[slides.length -1 ].classList.add("is-ref"); 
                    var carousel = $('.slider');
                    var seats = $('.slide');

                    var next = function(el) {
                      if (el.next().length > 0) {
                        return el.next();
                      } else {
                        return seats.first();
                      }
                    };

                    var progress = function(e) {
                      var el = $('.is-ref').removeClass('is-ref');
                      var new_seat = next(el);
                    
                      new_seat.addClass('is-ref').css('order', 1);
                      for (var i = 2, ref = seats.length; i <= ref; i++) {
                        new_seat = next(new_seat).css('order', i);
                      }
                  
                      carousel.removeClass('is-set');
                  
                      return setTimeout((function() {
                        return carousel.addClass('is-set');
                      }), 0);
                    };

                    window.setInterval(function(){
                      progress();
                    }, 5000);
                </script>
            </div>
        </main>
    </body>
</html>